 <!DOCTYPE html> <html> <head> <title>Using hooks &raquo; Capri - Classic object oriented JavaScript</title> <script src="http://shjs.sourceforge.net/sh_main.min.js"></script> <script src="http://shjs.sourceforge.net/lang/sh_javascript.min.js"></script> <link rel="stylesheet" type="text/css" href="http://capri.rotorz.com/style/syntax.css" /> <meta name="description" content="Capri is an open source library that allows developers to use classes and namespaces in the more classical sense. Capri also provides dynamic script and style includes when jQuery plugin variant is used." /> <meta name="keywords" content="javascript, capri, jquery, jquery plugin, javascript framework, oop, object-oriented, classes, namespaces, classical, inheritance" /> <link rel="stylesheet" type="text/css" href="http://capri.rotorz.com/style/main.css" /> <link rel="stylesheet" type="text/css" media="print" href="http://capri.rotorz.com/style/print.css" /> <link rel="alternate" type="application/rss+xml" title="Rotorz &raquo; Capri Feed" href="http://rotorz.com/blog/category/capri/feed/" /> <link rel="alternate" type="application/rss+xml" title="Rotorz &raquo; Feed" href="http://rotorz.com/blog/feed/" /> <!--[if lt IE 9]> <script type="text/javascript" src="http://capri.rotorz.com/script/ie-html5-fix.js"></script> <![endif]--> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-23827175-1']); _gaq.push(['_setDomainName', '.rotorz.com']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body class="docs-page info-page narrow-page"> <div class="wrap"> <header id="page-header"> <nav class="site-nav"> <ul> <li class="first"><a href="http://capri.rotorz.com">Home</a></li> <li><a href="http://capri.rotorz.com/about.html">About</a></li> <li><a href="http://capri.rotorz.com/getting-started.html">Docs</a></li> <li class="last"><a href="http://rotorz.com/blog/category/capri">Blog</a></li> </ul> </nav> <a class="home" href="http://capri.rotorz.com"><img src="http://capri.rotorz.com/img/home.png" alt="Capri Title" /></a> <nav class="sub-nav"> <ul> <li><a href="http://capri.rotorz.com/getting-started.html">Getting Started</a></li> <li><a href="http://capri.rotorz.com/tutorial/index.html">Tutorials</a></li> <li><a href="http://capri.rotorz.com/docs/global.html">API</a></li> </ul> </nav> </header> <div class="content-wrap"> <section class="content"> <h1>Using hooks</h1> <p>A hook is a mechanism that allows additional logic to be added without the need to alter the original source. Hooks can make it very easy to alter the way an application behaves both permanently or temporarily. This makes it easy to support plugins within your scripts because plugins can utilise the hooks exposed within your scripts to add, remove or change various things.</p> <p>Developers usually prefer not to alter source code that was written by other developers because it leads to a <a href="http://en.wikipedia.org/wiki/Fork_(software_development)">fork</a> (aka derived works). This can lead to problems further down the road because it becomes harder to update the library that was forked. Any changes that were made must be made again!</p> <p>Those who are familiar with the way that hooks work in WordPress will be at home with the one that Capri offers. Capri provides an additional argument that is passed to each callback that acts like an event object. Hook execution can be stopped early, and the original value can also be retrieved when needed. There are two kinds of hook:</p> <dl> <dt>Action</dt> <dd>Runs when a particular action is to be undertaken.</dd> <dt>Filter</dt> <dd>Apply filtering to an input.</dd> </dl> <p>Actions also have the ability to filter data when needed, this can be useful when feedback is required. For example, an action could yield the number of items that were updated.</p> <h2>Define hooks</h2> <p>Both kinds of hook can be defined via <samp><a href="http://capri.rotorz.com/docs/capri-hook.html">capri.Hook</a></samp>. Here are a couple of examples:</p> <div class="info-box"><strong>Warning:</strong> Client validation is not a substitute for server validation. A server cannot trust <em>anything</em> that comes from its clients. Data can be manipulated in a way that is malicious to achieve results that were not intended.</div> <pre class="sh_sourceCode sh_javascript"><code>
 function submitComment(comment, author, email) {
    // use action to validate e-mail address
    if (!capri.Hook.run('my.validate-email', email)) {
       alert('An invalid e-mail address was specified.');
       return;
    }
 
    var handlerUri = 'http://example.com/comment.php';
 
    jQuery.ajax({
       url     : capri.Hook.filter('my.comment-uri', handlerUri),
       type    : 'POST',
       data    : {
          "comment" : capri.Hook.filter('my.comment', comment),
          "author"  : capri.Hook.filter('my.author', author)
       },
       success : function(data) {
          capri.Hook.run('my.comment-posted', data);
       },
       error   : function(data) {
          capri.Hook.run('my.comment-failed', data);
       }
    });
 }
 </code></pre> <p>In the above example client validation is performed using a hook. This means that it is easy to alter the way in which e-mail addresses are validated. Whilst not the greatest example, it is also possible to replace the default comment handler URI. A custom message indicator could be added when comment is submitted successfully or when an error occurs:</p> <pre class="sh_sourceCode sh_javascript"><code>
 // add e-mail validation
 capri.Hook.add('my.validate-email', function(email) {
    // another hook could have already decided before this one!
    if (capri.typeOf(email) === 'boolean')
       return email;
 
    // very basic e-mail validation
    if (!/^[^@]+@[^@]+$/.test(email))
       return false;
 });
 
 // switch to a different comment handler
 capri.Hook.addFilter('my.comment-uri', function(uri, params, hook) {
    // stop further hooks from being able to change this
    hook.stop = true;
    // use a different comment handler
    return 'http://another-example.com/different-comment.php';
 });
 
 // reload page when comment was posted successfully
 capri.Hook.add('my.comment-posted', function() {
    capri.reloadPage();
 });
 
 // display alert when comment was not posted
 capri.Hook.add('my.comment-failed', function() {
    alert('Comment could not be posted, please check your inputs and try again.');
 });
 </code></pre> <p>Hook priorities can be used to determine when the callback is to be invoked. The following demonstrates how an alert could be added when a comment is posted before page is reloaded:</p> <pre class="sh_sourceCode sh_javascript"><code>
 // the default action priority is 10 so the following will happen before
 capri.Hook.add('my.comment-posted', function() {
    alert('Comment was posted!');
 }, 5);
 </code></pre> <h2>Summary</h2> <p>This tutorial has shown how hooks can be applied in JavaScript to facilitate the development of pluggable code. It is possible to alter the way that actions are undertaken and the way in which data is filtered. This is useful for complex applications and libraries. Actions and filters behave in a similar way to the ones in WordPress with the addition of the hook argument.</p> </section> <div id="website-license"> <div class="left"> <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a> </div> <div class="right"> <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Capri Project Website</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://rotorz.com" property="cc:attributionName" rel="cc:attributionURL">Rotorz Limited</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a> </div> <div class="clear"></div> </div> </div> <footer id="page-footer"> <a class="rotorz-home" href="http://rotorz.com" title="Rotorz Limited Home Page"><img src="http://capri.rotorz.com/img/rotorz-badge.jpg" /></a> <nav> <ul> <li><a href="http://rotorz.com/blog/category/capri">Blog</a></li> <li><a href="http://capri.rotorz.com/contribute.html">Contribute</a></li> <li><a href="http://github.com/rotorz/capri">Repository</a></li> <li><a href="http://capri.rotorz.com/license.html">License</a></li> <li><a href="http://rotorz.com/projects">Projects</a></li> </ul> </nav> <small>&copy; 2010-2011 Rotorz Limited. All rights reserved.</small> </footer> </div> <script>sh_highlightDocument();</script> </body> </html>