 <!DOCTYPE html> <html> <head> <title>Creating a widget &raquo; Capri - Classic object oriented JavaScript</title> <script src="http://shjs.sourceforge.net/sh_main.min.js"></script> <script src="http://shjs.sourceforge.net/lang/sh_xml.min.js"></script> <script src="http://shjs.sourceforge.net/lang/sh_javascript.min.js"></script> <link rel="stylesheet" type="text/css" href="http://capri.rotorz.com/style/syntax.css" /> <meta name="description" content="Capri is an open source library that allows developers to use classes and namespaces in the more classical sense. Capri also provides dynamic script and style includes when jQuery plugin variant is used." /> <meta name="keywords" content="javascript, capri, jquery, jquery plugin, javascript framework, oop, object-oriented, classes, namespaces, classical, inheritance" /> <link rel="stylesheet" type="text/css" href="http://capri.rotorz.com/style/main.css" /> <link rel="stylesheet" type="text/css" media="print" href="http://capri.rotorz.com/style/print.css" /> <link rel="alternate" type="application/rss+xml" title="Rotorz &raquo; Capri Feed" href="http://rotorz.com/blog/category/capri/feed/" /> <link rel="alternate" type="application/rss+xml" title="Rotorz &raquo; Feed" href="http://rotorz.com/blog/feed/" /> <!--[if lt IE 9]> <script type="text/javascript" src="http://capri.rotorz.com/script/ie-html5-fix.js"></script> <![endif]--> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-23827175-1']); _gaq.push(['_setDomainName', '.rotorz.com']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body class="docs-page info-page narrow-page"> <div class="wrap"> <header id="page-header"> <nav class="site-nav"> <ul> <li class="first"><a href="http://capri.rotorz.com">Home</a></li> <li><a href="http://capri.rotorz.com/about.html">About</a></li> <li><a href="http://capri.rotorz.com/getting-started.html">Docs</a></li> <li class="last"><a href="http://rotorz.com/blog/category/capri">Blog</a></li> </ul> </nav> <a class="home" href="http://capri.rotorz.com"><img src="http://capri.rotorz.com/img/home.png" alt="Capri Title" /></a> <nav class="sub-nav"> <ul> <li><a href="http://capri.rotorz.com/getting-started.html">Getting Started</a></li> <li><a href="http://capri.rotorz.com/tutorial/index.html">Tutorials</a></li> <li><a href="http://capri.rotorz.com/docs/global.html">API</a></li> </ul> </nav> </header> <div class="content-wrap"> <section class="content"> <h1>Creating a widget</h1> <p>Capri provides an alternative widget architecture that integrates into jQuery and can be used alongside jQuery UI widgets, interactions and effects. Capri widgets are implemented as classes and fully support namespaces.</p> <h2>Comparison with jQuery UI widgets</h2> <p>jQuery UI widgets can be implemented as basic jQuery plugins or by using <samp><a href="http://jqueryui.com/demos/widget/">jQuery.widget</a></samp> which allows the widget to be defined as a class.</p> <p>Capri extends this idea with classes that can be used to define abstract widgets or specialised variations of an existing widget. Capri also makes it easy to use namespaces to avoid conflicts with third-party widgets. All Capri widgets must inherit <samp><a href="http://capri.rotorz.com/docs/capri-ui-widget.html">capri.ui.Widget</a></samp>.</p> <p>Only one Capri widget can be associated with a particular element. Capri widgets can however be nested within one another. Advanced widgets could implement a container pattern.</p> <h2>Define a widget</h2> <p>Each Capri widget is defined as a class that inherits <samp><a href="http://capri.rotorz.com/docs/capri-ui-widget.html">capri.ui.Widget</a></samp> at some point in its class hierarchy.</p> <div class="info-box"><strong>Tip:</strong> It is a good idea to place widget classes within a vendor specific namespace to avoid cluttering the global namespace. "my" is used for the purposes of this example.</div> <p>A constructor can be used to pre-process options and/or store them in a different way. By default options are retained within each widget so that they can be accessed again when needed. Default option values are mixed in when defined statically, refer to API documentation for an example of this.</p> <p>Upon creation the method <samp>create</samp> is automatically invoked so that the element can be initialised. Where possible a create method should be used instead of defining a constructor. A <samp>destroy</samp> method can also be provided to remove widget from an element. This doesn't apply to the following example because only the text content of the element is changed.</p> <p>The associated element can be accessed via <samp>this.element</samp> and widget options can be accessed via <samp>this.options</samp> (unless overridden by constructor).</p> <pre class="sh_sourceCode sh_javascript"><code>
 $class('my.GreetingWidget', capri.ui.Widget, {
    create: function() {
       // add message to widget element
       this.greeting(this.options['greeting'] || 'Default greeting text!');
    },
    greeting: function(text) {
       if (text !== undefined) { // setter
          // alter greeting text
          this.element.text(text);
       }
       else { // getter
          // retrieve greeting text
          return this.element.text();
       }
    }
 });
 </code></pre> <p>The widget classes <samp>create</samp> method is used to initialise the widget class (when one is specified). In this example the create method simply initialises the greeting message. The <samp>greeting</samp> method represents a property by providing getter/setter functionality in a way that is familar with jQuery users.</p> <h2>Initialise widget and access widget</h2> <p>Each widget instance must be attached to an element and then initialised. Capri adds the function <samp>widget</samp> into the jQuery plugin namespace which can initialise and communicate with the attached widget object.</p> <p>The following HTML skeleton will be used for following examples. A greeting widget will be attached to each greeting element in the following markup.</p> <pre class="sh_sourceCode sh_xml"><code>
 &lt;!DOCTYPE html&gt;
 &lt;html&gt;
 &lt;head&gt;
    &lt;title&gt;Capri widget example&lt;/title&gt;
    &lt;script src=&quot;jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;jquery.capri.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;demo.js&quot;&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
    &lt;div id=&quot;greeting-a&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;greeting-b&quot;&gt;&lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;
 </code></pre> <p>A widget can be initialised by first selecting the primary widget element and then invoking <samp>widget</samp>. 'init' must be specified for the first parameter to indicate that a new widget is being initialised. The second parameter identifies the widget class which can be specified by name or by reference. The third parameter can be used to provide additional options.</p> <pre class="sh_sourceCode sh_javascript"><code>
 /* demo.js */
 
 // initialise `greeting-a` with default options
 $('#greeting-a').widget('init', my.GreetingWidget);
 // initialise `greeting-b` with custom options
 $('#greeting-b').widget('init', my.GreetingWidget, {
   "greeting": "hey!"
 });
 </code></pre> <div class="info-box"><strong>Note:</strong> In the above example the custom greeting message was identified using <samp>"greeting"</samp>, the double quotes are optional in this scenario. With quotes it is possible to use CSS style names like "default-colour".</div> <p>Both greeting widgets have now been initialised as <samp>my.GreetingWidget</samp>'s. Each element is associated with the greeting widget object (demonstrated later). This is implemented using the jQuery data method to avoid issues with circular references that would otherwise lead to memory leaks in some web browsers.</p> <p>The widget function can be used to relay a message to the widget object that is attached to an element. The first argument of <samp>widget</samp> identifies the name of the message. We previously used the reserved name "init" to initialise some widgets. The name of a widget method can be used instead to process or retrieve data. Any trailing arguments are passed into the widget method.</p> <pre class="sh_sourceCode sh_javascript"><code>
 // send message to widget to get greeting text
 var greetingTextB = $('#greeting-b').widget('greeting');
 // send message to widget to set greeting text
 $('#greeting-b').widget('greeting', 'New greeting text!');
 </code></pre> <p>The widget object that is associated with an element can be retrieved by calling <samp>widget</samp> without any parameters as shown in the following example:</p> <pre class="sh_sourceCode sh_javascript"><code>
 // get widget object from widget enabled element
 var widgetA = $('#greeting-a').widget();
 var widgetText = widgetA.greeting();
 // `widgetText` becomes "Default greeting text!"
 </code></pre> <h2>Summary</h2> <p>In this tutorial we have presented an alternative approach to implementing widgets that are compatible with jQuery. Widgets can be defined using an object oriented concepts. Unlike jQuery UI, only one widget can be attached to a particular element. This simplifies implementation and usage of widgets and allows widget classes to be namespaced to avoid conflicts.</p> <p><a href="using-hooks.html">Next tutorial: Using hooks</a></p> </section> <div id="website-license"> <div class="left"> <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a> </div> <div class="right"> <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Capri Project Website</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://rotorz.com" property="cc:attributionName" rel="cc:attributionURL">Rotorz Limited</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a> </div> <div class="clear"></div> </div> </div> <footer id="page-footer"> <a class="rotorz-home" href="http://rotorz.com" title="Rotorz Limited Home Page"><img src="http://capri.rotorz.com/img/rotorz-badge.jpg" /></a> <nav> <ul> <li><a href="http://rotorz.com/blog/category/capri">Blog</a></li> <li><a href="http://capri.rotorz.com/contribute.html">Contribute</a></li> <li><a href="http://github.com/rotorz/capri">Repository</a></li> <li><a href="http://capri.rotorz.com/license.html">License</a></li> <li><a href="http://rotorz.com/projects">Projects</a></li> </ul> </nav> <small>&copy; 2010-2011 Rotorz Limited. All rights reserved.</small> </footer> </div> <script>sh_highlightDocument();</script> </body> </html>